from utils.model_generation import ModelGenerator

gen = ModelGenerator()

# Activities
customer_signs_up = gen.activity('Customer signs up')
validate_info = gen.activity('Validate information')
generate_account = gen.activity('Generate account')
assign_access = gen.activity('Assign access')
set_auto_triggers = gen.activity('Set automatic triggers for billing cycles')
send_welcome_email = gen.activity('Send welcome email')
send_regular_updates = gen.activity('Send regular updates')
send_product_enhancements = gen.activity('Send product enhancements')
send_renewal_notifications = gen.activity('Send renewal notifications')
customer_submits_cancellation = gen.activity('Customer submits cancellation request')
support_receives_request = gen.activity('Support receives and reviews the cancellation request')
apply_refund = gen.activity('apply refund')
apply_charges = gen.activity('apply charges')
deactivate_subscription = gen.activity('Deactivate subscription')
settle_final_balance = gen.activity('Settle final account balance')


# Subprocesses
successful_signup = gen.partial_order(dependencies=[(generate_account, assign_access), (assign_access, set_auto_triggers), (generate_account, send_welcome_email)])
regular_updates_subprocess = gen.partial_order(dependencies=[(send_regular_updates,), (send_product_enhancements,), (send_renewal_notifications,)])
cancellation_process = gen.partial_order(dependencies=[(support_receives_request, apply_refund), (support_receives_request, apply_charges), (apply_refund, deactivate_subscription), (apply_charges, deactivate_subscription), (deactivate_subscription, settle_final_balance)])

#Combine the regular updates into the main process.  The original model tried to reuse settle_final_balance which is not allowed.
main_process = gen.partial_order(dependencies=[(customer_signs_up, validate_info), (validate_info, successful_signup), (successful_signup, regular_updates_subprocess), (successful_signup, customer_submits_cancellation), (customer_submits_cancellation, cancellation_process)])

final_model = main_process