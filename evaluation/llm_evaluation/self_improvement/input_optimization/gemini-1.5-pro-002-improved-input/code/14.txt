from utils.model_generation import ModelGenerator

gen = ModelGenerator()

outline_objectives = gen.activity('Outline objectives')
draft_plan = gen.activity('Draft plan')
conduct_strategic_alignment_meeting = gen.activity('Conduct strategic alignment meeting')
provide_feedback = gen.activity('Provide feedback')
review_budget_feasibility = gen.activity('Review budget feasibility')
adjust_plan = gen.activity('Adjust Plan')
documented_and_approve_adjustment = gen.activity('Documented and approve adjustment')
approve_final_budget = gen.activity('Approve final budget')
distribute_budget = gen.activity('Distribute budget')
implement_plan = gen.activity('Implement plan')

# Create copies for the reused activities
approve_final_budget_copy1 = approve_final_budget.copy()
approve_final_budget_copy2 = approve_final_budget.copy()
provide_feedback_copy = provide_feedback.copy()
review_budget_feasibility_copy = review_budget_feasibility.copy() # Copy for reuse

strategic_alignment_choice = gen.xor(approve_final_budget_copy1, provide_feedback)

# Create a copy of adjust_plan for use inside the loop
adjust_plan_copy = adjust_plan.copy()


adjustments_loop = gen.loop(
    do=adjust_plan,
    redo=gen.partial_order(
        dependencies=[
            (adjust_plan_copy, documented_and_approve_adjustment),
            (documented_and_approve_adjustment, review_budget_feasibility_copy) # Use copy here
        ]
    )
)

review_feasibility_choice = gen.xor(adjustments_loop, approve_final_budget_copy2)




final_model = gen.partial_order(
    dependencies=[
        (outline_objectives, draft_plan),
        (draft_plan, conduct_strategic_alignment_meeting),
        (conduct_strategic_alignment_meeting, strategic_alignment_choice),
        (provide_feedback_copy, draft_plan),  # Feedback loops back to drafting - Using the copy here!
        (strategic_alignment_choice, review_budget_feasibility),
        (review_budget_feasibility, review_feasibility_choice), 
        (review_feasibility_choice, distribute_budget),
        (distribute_budget, implement_plan)
    ]
)